{
	"info": {
		"_postman_id": "scan-validation-service-collection",
		"name": "Scan Validation Service - Technical API",
		"description": "Collection compl√®te pour Scan Validation Service (Port 3005). Service technique de validation tickets.\n\nüî• R√àGLE STRICTE: Service technique - PAS d'authentification utilisateur.\nLes bodies ne contiennent QUE les champs r√©els des sch√©mas SQL.\n‚ùå INTERDITS: id, created_at, updated_at (g√©r√©s automatiquement)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3005/api",
			"type": "string"
		},
		{
			"key": "testTicketId",
			"value": "ticket-123-abc",
			"type": "string"
		},
		{
			"key": "testEventId",
			"value": "event-456-def",
			"type": "string"
		},
		{
			"key": "testQRCode",
			"value": "QR-DATA-ENCODED-TICKET-123",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "üì∏ Ticket Validation",
			"item": [
				{
					"name": "Validate Ticket",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Ticket validated successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('scan_status');",
									"    pm.expect(jsonData.data).to.have.property('validation_result');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"qrCode\": \"{{testQRCode}}\",\n  \"scanContext\": {\n    \"location\": \"Entr√©e Principale\",\n    \"deviceId\": \"scanner-001\",\n    \"operatorId\": \"operator-123\"\n  }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/scans/validate",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scans",
								"validate"
							]
						}
					},
					"response": []
				},
				{
					"name": "Validate Ticket Offline",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Ticket validated offline successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('scan_status');",
									"    pm.expect(jsonData.data).to.have.property('offline_mode');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"ticketId\": \"{{testTicketId}}\",\n  \"scanContext\": {\n    \"location\": \"Entr√©e Secondaire\",\n    \"deviceId\": \"scanner-002\",\n    \"operatorId\": \"operator-456\",\n    \"offlineMode\": true\n  }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/scans/validate-offline",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scans",
								"validate-offline"
							]
						}
					},
					"response": []
				}
			],
			"description": "Validation de tickets en temps r√©el et mode offline"
		},
		{
			"name": "üìä Scan History & Stats",
			"item": [
				{
					"name": "Get Ticket Scan History",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Ticket scan history retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/scans/history/ticket/{{testTicketId}}?limit=50&offset=0",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scans",
								"history",
								"ticket",
								"{{testTicketId}}"
							],
							"query": [
								{
									"key": "limit",
									"value": "50"
								},
								{
									"key": "offset",
									"value": "0"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Event Scan Stats",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Event scan stats retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('stats');",
									"    pm.expect(jsonData.data.stats).to.have.property('total_scans');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/scans/stats/event/{{testEventId}}?startDate=2025-01-01&endDate=2025-01-31",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scans",
								"stats",
								"event",
								"{{testEventId}}"
							],
							"query": [
								{
									"key": "startDate",
									"value": "2025-01-01"
								},
								{
									"key": "endDate",
									"value": "2025-01-31"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Global Stats",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Global stats retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('total_scans');",
									"    pm.expect(jsonData.data).to.have.property('active_scanners');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/scans/stats",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scans",
								"stats"
							]
						}
					},
					"response": []
				}
			],
			"description": "Historique des scans et statistiques"
		},
		{
			"name": "üè• Health & Monitoring",
			"item": [
				{
					"name": "Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Health check successful\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('status');",
									"    pm.expect(jsonData.data.status).to.eql('healthy');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/scans/health",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scans",
								"health"
							]
						}
					},
					"response": []
				}
			],
			"description": "Monitoring et sant√© du service"
		},
		{
			"name": "üîç Fraud Detection",
			"item": [
				{
					"name": "Check Fraud Patterns",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Fraud patterns checked successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('fraud_score');",
									"    pm.expect(jsonData.data).to.have.property('risk_level');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"ticketId\": \"{{testTicketId}}\",\n  \"scanContext\": {\n    \"location\": \"Entr√©e Principale\",\n    \"deviceId\": \"scanner-001\",\n    \"operatorId\": \"operator-123\",\n    \"timestamp\": \"2025-01-29T10:30:00Z\"\n  },\n  \"checkPatterns\": [\n    \"multiple_scans_short_time\",\n    \"unusual_location\",\n    \"device_anomaly\",\n    \"time_pattern_violation\"\n  ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/scans/fraud/check",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scans",
								"fraud",
								"check"
							]
						}
					},
					"response": []
				},
				{
					"name": "Report Suspicious Activity",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Suspicious activity reported successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('report_id');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"ticketId\": \"{{testTicketId}}\",\n  \"reason\": \"Multiple tentatives de validation dans un court laps de temps\",\n  \"severity\": \"high\",\n  \"evidence\": {\n    \"scan_attempts\": 5,\n    \"time_span_minutes\": 2,\n    \"locations\": [\"Entr√©e Principale\", \"Entr√©e Secondaire\"],\n    \"devices\": [\"scanner-001\", \"scanner-003\"]\n  },\n  \"reportedBy\": \"operator-123\",\n  \"additionalNotes\": \"Comportement suspect d√©tect√© par le syst√®me anti-fraude\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/scans/fraud/report",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scans",
								"fraud",
								"report"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Fraud Reports",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Fraud reports retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/scans/fraud/reports?severity=high&status=open&limit=20",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scans",
								"fraud",
								"reports"
							],
							"query": [
								{
									"key": "severity",
									"value": "high"
								},
								{
									"key": "status",
									"value": "open"
								},
								{
									"key": "limit",
									"value": "20"
								}
							]
						}
					},
					"response": []
				}
			],
			"description": "D√©tection et signalement d'activit√©s frauduleuses"
		},
		{
			"name": "üì± Scanner Management",
			"item": [
				{
					"name": "Register Scanner",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Scanner registered successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('scanner_id');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"device_name\": \"Scanner Principal Entr√©e\",\n  \"device_type\": \"mobile\",\n  \"location\": \"Entr√©e Principale - Hall A\",\n  \"operator_id\": \"operator-123\",\n  \"settings\": {\n    \"auto_validate\": true,\n    \"fraud_detection\": true,\n    \"scan_timeout_seconds\": 30,\n    \"max_scans_per_minute\": 60\n  }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/scanners/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scanners",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Scanner Info",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Scanner info retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('device_name');",
									"    pm.expect(jsonData.data).to.have.property('total_scans');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/scanners/scanner-001",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scanners",
								"scanner-001"
							]
						}
					},
					"response": []
				},
				{
					"name": "Update Scanner Status",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Scanner status updated successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"status\": \"maintenance\",\n  \"location\": \"Entr√©e Principale - Hall B\",\n  \"operator_id\": \"operator-456\",\n  \"settings\": {\n    \"auto_validate\": false,\n    \"maintenance_mode\": true\n  }\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/scanners/scanner-001/status",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scanners",
								"scanner-001",
								"status"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Active Scanners",
					"event": [
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Active scanners retrieved successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});"
								]
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/scanners/active?location=Entr√©e%20Principale",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"scanners",
								"active"
							],
							"query": [
								{
									"key": "location",
									"value": "Entr√©e Principale"
								}
							]
						}
					},
					"response": []
				}
			],
			"description": "Gestion des appareils de scan"
		}
	]
}
