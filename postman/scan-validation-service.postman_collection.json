{
  "info": {
    "name": "Scan Validation Service API",
    "description": "API collection for Scan Validation Service with centralized security and validation",
    "version": "2.0.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{auth_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3005",
      "type": "string"
    },
    {
      "key": "auth_token",
      "value": "your_jwt_token_here",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Ticket Validation",
      "item": [
        {
          "name": "Validate Ticket (Real-time)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"qrCode\": \"QR_CODE_DATA_HERE\",\n  \"scanContext\": {\n    \"location\": \"Main Entrance\",\n    \"deviceId\": \"scanner_001\",\n    \"checkpointId\": \"checkpoint_main\",\n    \"timestamp\": \"2024-06-15T09:30:00Z\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/validate",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "validate"]
            },
            "description": "Validate a ticket in real-time (requires scans.validate permission)"
          },
          "response": []
        },
        {
          "name": "Validate Ticket (Offline)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"qrCode\": \"QR_CODE_DATA_HERE\",\n  \"scanContext\": {\n    \"location\": \"Main Entrance\",\n    \"deviceId\": \"scanner_001\",\n    \"checkpointId\": \"checkpoint_main\",\n    \"timestamp\": \"2024-06-15T09:30:00Z\",\n    \"offlineMode\": true\n  },\n  \"offlineData\": {\n    \"cachedTickets\": [],\n    \"lastSync\": \"2024-06-15T08:00:00Z\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/validate-offline",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "validate-offline"]
            },
            "description": "Validate a ticket in offline mode (requires scans.validate.offline permission)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "QR Code Generation",
      "item": [
        {
          "name": "Generate QR Code",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"ticketId\": \"{{ticket_id}}\",\n  \"eventId\": \"{{event_id}}\",\n  \"ticketType\": \"standard\",\n  \"format\": \"base64\",\n  \"size\": \"medium\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/qr/generate",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "qr", "generate"]
            },
            "description": "Generate QR code for a ticket (requires scans.qr.generate permission)"
          },
          "response": []
        },
        {
          "name": "Generate Batch QR Codes",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tickets\": [\n    {\n      \"ticketId\": \"{{ticket_id_1}}\",\n      \"eventId\": \"{{event_id}}\",\n      \"ticketType\": \"standard\",\n      \"attendeeInfo\": {\n        \"name\": \"John Doe\",\n        \"email\": \"john@example.com\"\n      }\n    },\n    {\n      \"ticketId\": \"{{ticket_id_2}}\",\n      \"eventId\": \"{{event_id}}\",\n      \"ticketType\": \"vip\",\n      \"attendeeInfo\": {\n        \"name\": \"Jane Smith\",\n        \"email\": \"jane@example.com\"\n      }\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/qr/batch",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "qr", "batch"]
            },
            "description": "Generate QR codes in batch (requires scans.qr.batch permission)"
          },
          "response": []
        },
        {
          "name": "Generate Test QR Code",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"ticketType\": \"standard\",\n  \"eventId\": \"{{event_id}}\",\n  \"testData\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/qr/test",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "qr", "test"]
            },
            "description": "Generate test QR code (requires scans.qr.test permission)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Statistics & Analytics",
      "item": [
        {
          "name": "Get Scan Statistics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/scans/stats?period=day&eventId={{event_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "stats"],
              "query": [
                {
                  "key": "period",
                  "value": "day",
                  "description": "Time period (hour, day, week, month)"
                },
                {
                  "key": "eventId",
                  "value": "{{event_id}}",
                  "description": "Filter by event ID"
                }
              ]
            },
            "description": "Get scan statistics (requires scans.stats.read permission)"
          },
          "response": []
        },
        {
          "name": "Get Real-time Statistics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/scans/stats/realtime?eventId={{event_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "stats", "realtime"],
              "query": [
                {
                  "key": "eventId",
                  "value": "{{event_id}}",
                  "description": "Filter by event ID"
                }
              ]
            },
            "description": "Get real-time scan statistics (requires scans.stats.realtime permission)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Fraud Detection",
      "item": [
        {
          "name": "Analyze Fraud",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"scanData\": {\n    \"qrCode\": \"QR_CODE_DATA_HERE\",\n    \"scanContext\": {\n      \"location\": \"Main Entrance\",\n      \"deviceId\": \"scanner_001\",\n      \"timestamp\": \"2024-06-15T09:30:00Z\"\n    }\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/fraud/analyze",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "fraud", "analyze"]
            },
            "description": "Analyze scan for fraud detection (requires scans.fraud.analyze permission)"
          },
          "response": []
        },
        {
          "name": "Get Fraud Statistics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/scans/fraud/stats?eventId={{event_id}}&period=24h",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "fraud", "stats"],
              "query": [
                {
                  "key": "eventId",
                  "value": "{{event_id}}",
                  "description": "Filter by event ID"
                },
                {
                  "key": "period",
                  "value": "24h",
                  "description": "Time period (1h, 24h, 7d, 30d)"
                }
              ]
            },
            "description": "Get fraud detection statistics (requires scans.fraud.stats permission)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Scan History",
      "item": [
        {
          "name": "Get Ticket Scan History",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/scans/history/ticket/{{ticket_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "history", "ticket", "{{ticket_id}}"]
            },
            "description": "Get scan history for a specific ticket (requires scans.history.read permission)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Offline Sync",
      "item": [
        {
          "name": "Sync Offline Data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"scanData\": [\n    {\n      \"qrCode\": \"QR_CODE_1\",\n      \"scanResult\": {\n        \"valid\": true,\n        \"timestamp\": \"2024-06-15T09:30:00Z\"\n      },\n      \"timestamp\": \"2024-06-15T09:30:00Z\",\n      \"deviceId\": \"scanner_001\"\n    },\n    {\n      \"qrCode\": \"QR_CODE_2\",\n      \"scanResult\": {\n        \"valid\": true,\n        \"timestamp\": \"2024-06-15T09:35:00Z\"\n      },\n      \"timestamp\": \"2024-06-15T09:35:00Z\",\n      \"deviceId\": \"scanner_001\"\n    }\n  ],\n  \"deviceId\": \"scanner_001\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/sync",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "sync"]
            },
            "description": "Synchronize offline scan data (requires scans.sync permission)"
          },
          "response": []
        },
        {
          "name": "Get Offline Data",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/scans/offline/data?ticketId={{ticket_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "offline", "data"],
              "query": [
                {
                  "key": "ticketId",
                  "value": "{{ticket_id}}",
                  "description": "Filter by ticket ID"
                }
              ]
            },
            "description": "Get offline cached data (requires scans.offline.read permission)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Scan Sessions",
      "item": [
        {
          "name": "Start Scan Session",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"eventId\": \"{{event_id}}\",\n  \"operatorId\": \"{{operator_id}}\",\n  \"deviceId\": \"scanner_001\",\n  \"checkpointId\": \"checkpoint_main\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/sessions/start",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "sessions", "start"]
            },
            "description": "Start a new scan session (requires scans.sessions.create permission)"
          },
          "response": []
        },
        {
          "name": "End Scan Session",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sessionId\": \"{{session_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/sessions/end",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "sessions", "end"]
            },
            "description": "End a scan session (requires scans.sessions.update permission)"
          },
          "response": []
        },
        {
          "name": "Get Active Scan Sessions",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/scans/sessions/active?eventId={{event_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "sessions", "active"],
              "query": [
                {
                  "key": "eventId",
                  "value": "{{event_id}}",
                  "description": "Filter by event ID"
                }
              ]
            },
            "description": "Get active scan sessions (requires scans.sessions.read permission)"
          },
          "response": []
        },
        {
          "name": "Get Scan Session",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/scans/sessions/{{session_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "sessions", "{{session_id}}"]
            },
            "description": "Get scan session details (requires scans.sessions.read permission)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Operators Management",
      "item": [
        {
          "name": "Register Scan Operator",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{user_id}}\",\n  \"eventId\": \"{{event_id}}\",\n  \"role\": \"operator\",\n  \"permissions\": [\"scans.validate\", \"scans.stats.read\"]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/operators/register",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "operators", "register"]
            },
            "description": "Register a scan operator (requires scans.operators.create permission)"
          },
          "response": []
        },
        {
          "name": "Get Event Scan Operators",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/scans/operators/event/{{event_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "operators", "event", "{{event_id}}"]
            },
            "description": "Get scan operators for an event (requires scans.operators.read permission)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Devices Management",
      "item": [
        {
          "name": "Register Scan Device",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"deviceId\": \"scanner_001\",\n  \"eventId\": \"{{event_id}}\",\n  \"deviceType\": \"mobile\",\n  \"location\": \"Main Entrance\",\n  \"capabilities\": [\"qr_scan\", \"offline_mode\", \"fraud_detection\"]\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/scans/devices/register",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "devices", "register"]
            },
            "description": "Register a scan device (requires scans.devices.create permission)"
          },
          "response": []
        },
        {
          "name": "Get Event Scan Devices",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/scans/devices/event/{{event_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "scans", "devices", "event", "{{event_id}}"]
            },
            "description": "Get scan devices for an event (requires scans.devices.read permission)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Health & Monitoring",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Basic health check (no authentication required)"
          },
          "response": []
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "exec": [
          "// Auto-refresh token if needed",
          "if (pm.collectionVariables.get('auth_token') === 'your_jwt_token_here') {",
          "    pm.collectionVariables.set('auth_token', 'your_real_jwt_token');",
          "}"
        ],
        "type": "text/javascript"
      }
    }
  ]
}
